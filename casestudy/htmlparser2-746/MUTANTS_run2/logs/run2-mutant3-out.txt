
> htmlparser2@6.0.0 test
> jest --coverage

FAIL src/__tests__/events.ts
  ‚óè Test suite failed to run

    [96msrc/Tokenizer.ts[0m:[93m370[0m:[93m17[0m - [91merror[0m[90m TS2367: [0mThis condition will always return 'true' since the types 'Special.Script | Special.Style | Special.Title' and 'Special.None' have no overlap.

    [7m370[0m             if (this.special !== Special.None || (c === "a" || c === "A")) {
    [7m   [0m [91m                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m

PASS src/FeedHandler.spec.ts
FAIL src/__tests__/stream.ts
  ‚óè Stream ‚Ä∫ Basic html

    expect(received).toBeNull()

    Received: [Error: expect(received).toStrictEqual(expected) // deep equality¬∑
    - Expected  - 26
    + Received  +  1¬∑
    @@ -32,42 +32,17 @@
          ],
          "event": "opentag",
        },
        Object {
          "data": Array [
    -       "The Title",
    +       "The Title</title><body>Hello world</body></html>",
          ],
          "event": "text",
        },
        Object {
          "data": Array [
            "title",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "Hello world",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
          ],
          "event": "closetag",
        },
        Object {
          "data": Array []

      91 | 
      92 |     return (err: null | Error, actual?: unknown | unknown[]) => {
    > 93 |         expect(err).toBeNull();
         |                     ^
      94 |         if (file.useSnapshot) {
      95 |             expect(actual).toMatchSnapshot();
      96 |         } else {

      at WritableStream.<anonymous> (src/__fixtures__/test-helper.ts:93:21)

  ‚óè Stream ‚Ä∫ Attributes

    expect(received).toBeNull()

    Received: [Error: expect(received).toStrictEqual(expected) // deep equality¬∑
    - Expected  - 279
    + Received  +  12¬∑
    @@ -66,304 +66,37 @@
          ],
          "event": "opentag",
        },
        Object {
          "data": Array [
    -       "Attributes test",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "head",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       " Normal attributes ",
    -     ],
    -     "event": "comment",
    -   },
    -   Object {
    -     "data": Array [],
    -     "event": "commentend",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "id",
    -       "test0",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "class",
    -       "value0",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -       "value1",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -       Object {
    -         "class": "value0",
    -         "id": "test0",
    -         "title": "value1",
    -       },
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "class=\"value0\" title=\"value1\"",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    +       "Attributes test</title>
    + </head>
    + <body>
    + 	<!-- Normal attributes -->
    + 	<button id=\"test0\" class=\"value0\" title=\"value1\">class=\"value0\" title=\"value1\"</button>¬∑
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       " Attributes with no quotes or value ",
    -     ],
    -     "event": "comment",
    -   },
    -   Object {
    -     "data": Array [],
    -     "event": "commentend",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "id",
    -       "test1",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "class",
    -       "value2",
    -       null,
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "disabled",
    -       "",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -       Object {
    -         "class": "value2",
    -         "disabled": "",
    -         "id": "test1",
    -       },
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "class=value2 disabled",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    + 	<!-- Attributes with no quotes or value -->
    + 	<button id=\"test1\" class=value2 disabled>class=value2 disabled</button>¬∑
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       " Attributes with no space between them. No valid, but accepted by the browser ",
    -     ],
    -     "event": "comment",
    -   },
    -   Object {
    -     "data": Array [],
    -     "event": "commentend",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 	",
    + 	<!-- Attributes with no space between them. No valid, but accepted by the browser -->
    + 	<button id=\"test2\" class=\"value4\"title=\"value5\">class=\"value4\"title=\"value5\"</button>
    + </body>
    + </html>",
          ],
          "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "id",
    -       "test2",
    -       "\"",
    -     ],
    -     "event": "attribute",
        },
        Object {
          "data": Array [
    -       "class",
    -       "value4",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
            "title",
    -       "value5",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -       Object {
    -         "class": "value4",
    -         "id": "test2",
    -         "title": "value5",
    -       },
          ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "class=\"value4\"title=\"value5\"",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "button",
    -     ],
          "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
        },
        Object {
          "data": Array [
    -       "body",
    +       "head",
          ],
          "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
        },
        Object {
          "data": Array [
            "html",
          ],]

      91 | 
      92 |     return (err: null | Error, actual?: unknown | unknown[]) => {
    > 93 |         expect(err).toBeNull();
         |                     ^
      94 |         if (file.useSnapshot) {
      95 |             expect(actual).toMatchSnapshot();
      96 |         } else {

      at WritableStream.<anonymous> (src/__fixtures__/test-helper.ts:93:21)

  ‚óè Stream ‚Ä∫ SVG

    expect(received).toBeNull()

    Received: [Error: expect(received).toStrictEqual(expected) // deep equality¬∑
    - Expected  - 324
    + Received  +  17¬∑
    @@ -66,124 +66,27 @@
          ],
          "event": "opentag",
        },
        Object {
          "data": Array [
    -       "SVG test",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "head",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    +       "SVG test</title>
    + </head>
    + <body>
    + 	<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">
    + 		<title>Test</title>
    + 		<animate />
    + 		<polygon />
    + 		<g>
    + 			<path>
    + 				<title>x</title>
    + 				<animate />
    + 			</path>
    + 		</g>
    + 	</svg>
    + </body>
    + </html>
      ",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "svg",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "version",
    -       "1.1",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "xmlns",
    -       "http://www.w3.org/2000/svg",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "xmlns:xlink",
    -       "http://www.w3.org/1999/xlink",
    -       "\"",
    -     ],
    -     "event": "attribute",
    -   },
    -   Object {
    -     "data": Array [
    -       "svg",
    -       Object {
    -         "version": "1.1",
    -         "xmlns": "http://www.w3.org/2000/svg",
    -         "xmlns:xlink": "http://www.w3.org/1999/xlink",
    -       },
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 		",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "Test",
          ],
          "event": "text",
        },
        Object {
          "data": Array [
    @@ -191,226 +94,16 @@
          ],
          "event": "closetag",
        },
        Object {
          "data": Array [
    -       "
    - 		",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "animate",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "animate",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "animate",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 		",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "polygon",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "polygon",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "polygon",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 		",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "g",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "g",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 			",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "path",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "path",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 				",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "x",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "title",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 				",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "animate",
    -     ],
    -     "event": "opentagname",
    -   },
    -   Object {
    -     "data": Array [
    -       "animate",
    -       Object {},
    -     ],
    -     "event": "opentag",
    -   },
    -   Object {
    -     "data": Array [
    -       "animate",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 			",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "path",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 		",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "g",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - 	",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "svg",
    +       "head",
          ],
          "event": "closetag",
        },
        Object {
          "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
    -       "body",
    -     ],
    -     "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
    -   },
    -   Object {
    -     "data": Array [
            "html",
          ],
          "event": "closetag",
    -   },
    -   Object {
    -     "data": Array [
    -       "
    - ",
    -     ],
    -     "event": "text",
        },
      ]]

      91 | 
      92 |     return (err: null | Error, actual?: unknown | unknown[]) => {
    > 93 |         expect(err).toBeNull();
         |                     ^
      94 |         if (file.useSnapshot) {
      95 |             expect(actual).toMatchSnapshot();
      96 |         } else {

      at WritableStream.<anonymous> (src/__fixtures__/test-helper.ts:93:21)

PASS src/Parser.spec.ts
FAIL src/Tokenizer.spec.ts
  ‚óè Tokenizer ‚Ä∫ should support standard special tags

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 3

      Array [
        "onopentagname: 'title'",
        "onopentagend",
    -   "onclosetag: 'title'",
    -   "onopentagname: 'div'",
    -   "onopentagend",
    -   "onclosetag: 'div'",
    +   "ontext: '</title>'",
    +   "ontext: '<div>'",
    +   "ontext: '</div>'",
        "onend",
      ]

      165 |         tokenizer.write(normalTitleInput);
      166 |         tokenizer.end();
    > 167 |         expect(logger.log).toEqual(normalTitleOutput);
          |                            ^
      168 |         tokenizer.reset();
      169 |         logger.log = [];
      170 |     });

      at Object.<anonymous> (src/Tokenizer.spec.ts:167:28)

PASS src/index.spec.ts
PASS src/WritableStream.spec.ts
-----------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                   | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                                       
-----------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files              |   86.15 |    76.24 |   93.92 |   86.24 |                                                                                                                                                                                                                         
 src                   |   85.65 |    75.71 |   93.38 |   85.79 |                                                                                                                                                                                                                         
  CollectingHandler.ts |   58.33 |       35 |      60 |   66.67 | 17-18,22-25                                                                                                                                                                                                             
  FeedHandler.ts       |   91.27 |    75.34 |     100 |   90.98 | 80-81,189,192,195,199,202,205,208,211,220                                                                                                                                                                               
  MultiplexHandler.ts  |   93.55 |      100 |    87.5 |   93.55 | 52,61                                                                                                                                                                                                                   
  Parser.ts            |   91.82 |    84.81 |    96.3 |   91.72 | 259,265,285,293,314-320,332,410,492                                                                                                                                                                                     
  Tokenizer.ts         |   82.38 |    74.17 |   93.22 |   82.16 | 331-332,368,372-379,382-383,421-423,441-444,452-453,466-469,476,485-488,518,525-530,537,548-549,558-559,567,578,588-589,612,632-643,655,659-670,677-680,686,691,698,707,758,770,796,846,848,850,852,883,893,899-941,958 
  WritableStream.ts    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                         
  index.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                         
 src/__fixtures__      |   97.56 |       95 |     100 |    97.3 |                                                                                                                                                                                                                         
  test-helper.ts       |   97.56 |       95 |     100 |    97.3 | 71                                                                                                                                                                                                                      
-----------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Test Suites: 3 failed, 4 passed, 7 total
Tests:       4 failed, 19 passed, 23 total
Snapshots:   10 passed, 10 total
Time:        2.565 s
Ran all test suites.
